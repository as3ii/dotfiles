#!/bin/sh
# bspwm config file

TERMINAL="alacritty"    # terminal emulator command
TERMINALC="Alacritty"   # terminal emulator class

# exec function: run only if not allready running
run() {
    if ! pgrep -f "$1"; then
        $1 &
    fi
}

### early start programs ###
run sxhkd                                               # keybindings
run "picom --daemon"                                    # compositor
run "dunst"                                             # notification daemon
run nm-applet                                           # NetworkManager applet
numlockx on                                             # enable numlock
run ~/.script/wallpaper.sh                              # wallpaper script
run "aa-notify -p -s 1 -w 60 -f /var/log/audit/audit.log" # apparmor notification
run "polybar -r example"
run "xbanish"
run "optimus-manager-qt"
# exec mpd
if ! pgrep -f "mpd"; then
    (prlimit --rtprio=40 --rttime=unlimited mpd --verbose && run "mpd-mpris") &
fi
run "mpd-mpris"
# set alsa config
if cat /proc/asound/card*/id | grep -i keyboard ; then
    ln -sf ~/.config/asoundrc.keyboard ~/.asoundrc
else
    ln -sf ~/.config/asoundrc.pch ~/.asoundrc
fi

# keyboard settings
setxkbmap it


ws1="I"
ws2="II"
ws3="III"
ws4="IV"
ws5="V"
ws6="VI"
ws7="VII"
ws8="VIII"
ws9="IX"
ws10="X"

### monitor settings ###
if xrandr -q | grep HDML1 | awk '{print $2}' | grep -q connected; then
    xrandr --output HDMI1 --above eDP1
    bspc monitor HDMI1 -d $ws1 $ws2 $ws3 $ws4 $ws5 $ws6 $ws7 $ws8 $ws9 $ws10
fi
xrandr --output eDP1 --primary 2>&1 | grep warning || xrandr --output "$(xrandr --listmonitors | awk '{printf $4}')" --primary
bspc monitor "$(bspc query --names -M)" -d $ws1 $ws2 $ws3 $ws4 $ws5 $ws6 $ws7 $ws8 $ws9 $ws10


## WM config ##
bspc config border_width                  2
bspc config window_gap                    0
bspc config top_padding                   26
bspc config bottom_padding                0
bspc config left_padding                  0
bspc config right_padding                 0
bspc config single_monocle                false
bspc config split_ratio                   0.50
bspc config borderless_monocle            true
bspc config gapless_monocle               true
bspc config focus_follows_pointer         true
bspc config remove_disabled_monitors      true
bspc config merge_overlapping_monitors    true


# default workspace # xprop -> WM_CLASS(string) -> second argument
bspc rule -a "firefox" desktop=$ws3
bspc rule -a "Tor Browser" desktop=$ws3
bspc rule -a "TelegramDesktop" desktop=$ws4
bspc rule -a "mpv" desktop=$ws5
bspc rule -a "qBittorrent" desktop=$ws6
bspc rule -a "Thunderbird" desktop=$ws7
bspc rule -a $TERMINALC:"alsamixer" desktop=$ws8
bspc rule -a $TERMINALC:"htop" desktop=$ws9
bspc rule -a $TERMINALC:"nmon" desktop=$ws9
bspc rule -a "Keybase" desktop=$ws10
bspc rule -a $TERMINALC:"ncmpcpp" desktop=$ws10


# late start programs
run firefox
run telegram-desktop
run "$TERMINAL --class alsamixer -e alsamixer"
run "$TERMINAL --class htop -e htop"
run "$TERMINAL --class nmon -e nmon"
run thunderbird
if ! pgrep -f "keybase"; then
    run_keybase -a
fi
run "$TERMINAL --class ncmpcpp -e ncmpcpp"

